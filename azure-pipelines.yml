trigger:
- main

pool:
  vmImage: 'ubuntu-latest'

variables:
  GITHUB_TOKEN: $(GITHUB_TOKEN)

steps:
- checkout: self
  clean: true

# Install Chrome and dependencies for headless mode
- script: |
    sudo apt-get update
    sudo apt-get install -y wget curl unzip
    sudo apt-get install -y libxss1 libappindicator3-1 libindicator7
    sudo apt-get install -y fonts-liberation
    sudo apt-get install -y libnss3 libgdk-pixbuf2.0-0 libasound2
    sudo apt-get install -y libnspr4 libx11-xcb1
    sudo apt-get install -y google-chrome-stable
  displayName: 'Install Chrome dependencies'

- script: |
    echo Authenticating to GitHub
    git config --global url.https://$(GITHUB_TOKEN)@github.com/.insteadOf https://github.com/
    echo Navigate to the Maven project folder
    cd CucumberJavaProjectWithSeleniumAndTestNG # Replace with the folder containing your pom.xml
    echo Run Maven Tests with -e switch
    mvn clean test -e
  displayName: "Run Maven Tests with -e switch"

- task: PublishBuildArtifacts@1
  inputs:
    pathtoPublish: '$(Build.SourcesDirectory)/CucumberJavaProjectWithSeleniumAndTestNG/target/surefire-reports'
    artifactName: 'surefire-reports'
    publishLocation: 'Container'
  displayName: "Publish Surefire Reports"